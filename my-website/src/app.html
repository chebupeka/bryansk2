<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Честные Числа — Прозрачный ГСЧ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: white;
      color: #1a1a1a;
      font-family: "Inter", sans-serif;
    }
    .hero {
      background: linear-gradient(135deg, #ffe600, #fff7b3);
    }
    .section {
      border-top: 1px solid #f1f1f1;
      padding: 60px 20px;
    }
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
  </style>
</head>
<body>

  <!-- Герой-блок -->
  <section class="hero min-h-screen flex flex-col justify-center items-center text-center px-4">
    <h1 class="text-5xl font-bold mb-4">Честные Числа</h1>
    <p class="text-lg mb-8 max-w-2xl">
      Инновационный генератор случайных чисел, который показывает, как именно рождается случайность.
      Прозрачность, доверие и технология — в одном интерфейсе.
    </p>
    <button id="startBtn" class="px-6 py-3 bg-black text-white rounded-xl hover:bg-gray-800 transition">
      Запустить генерацию
    </button>
  </section>

  <!-- Визуализация работы ГСЧ -->
  <section class="section text-center">
    <h2 class="text-3xl font-semibold mb-6">Визуализация процесса генерации</h2>
    <p class="max-w-2xl mx-auto text-gray-700 mb-8">
      Система объединяет шум, движения, джиттер и криптографические операции в единый поток энтропии.
      Каждый шаг можно увидеть ниже.
    </p>

    <div class="max-w-4xl mx-auto grid grid-cols-3 gap-6">
      <div class="rounded-2xl p-6 border">
        <div class="text-sm text-gray-600 mb-1">Оценка энтропии</div>
        <div id="entropyBits" class="text-3xl font-bold">0 б.</div>
      </div>
      <div class="rounded-2xl p-6 border">
        <div class="text-sm text-gray-600 mb-1">Байт в пуле</div>
        <div id="poolBytes" class="text-3xl font-bold">0</div>
      </div>
      <div class="rounded-2xl p-6 border">
        <div class="text-sm text-gray-600 mb-1">SHA-256 хэш пула</div>
        <div id="poolHash" class="mono text-xs break-all text-gray-500">—</div>
      </div>
    </div>

    <canvas id="entropyGraph" class="mt-8 w-full max-w-4xl h-40 border rounded-xl mx-auto"></canvas>
  </section>

  <!-- Тесты генератора -->
  <section class="section text-center">
    <h2 class="text-3xl font-semibold mb-6">Тесты генератора</h2>
    <p class="max-w-2xl mx-auto text-gray-700 mb-8">
      Для проверки корректности работы ГСЧ выполните базовые статистические тесты:
      равномерность, независимость и отсутствие корреляции.
    </p>

    <div class="flex justify-center gap-4 flex-wrap">
      <button id="btnUniformity" class="px-5 py-3 bg-yellow-400 text-black rounded-lg hover:bg-yellow-500 transition">Проверить равномерность</button>
      <button id="btnIndependence" class="px-5 py-3 bg-yellow-400 text-black rounded-lg hover:bg-yellow-500 transition">Проверить независимость</button>
      <button id="btnCorrelation" class="px-5 py-3 bg-yellow-400 text-black rounded-lg hover:bg-yellow-500 transition">Проверить корреляцию</button>
    </div>

    <div id="testResults" class="mt-8 text-left max-w-3xl mx-auto bg-gray-50 border rounded-xl p-4 mono text-sm text-gray-700"></div>
  </section>

  <!-- Прозрачность -->
  <section class="section text-center">
    <h2 class="text-3xl font-semibold mb-6">Прозрачность и доверие</h2>
    <p class="max-w-2xl mx-auto text-gray-700 mb-4">
      Каждый сеанс фиксируется хэшем (commit), затем можно открыть исходный seed (reveal) —
      чтобы любой мог убедиться, что результат не был подделан.
    </p>
    <button id="btnCommit" class="px-5 py-3 bg-black text-white rounded-lg hover:bg-gray-800 transition">Commit</button>
    <button id="btnReveal" class="px-5 py-3 bg-yellow-400 text-black rounded-lg hover:bg-yellow-500 transition ml-3" disabled>Reveal</button>
    <p id="commitHash" class="mono text-xs text-gray-500 mt-4 break-all">—</p>
  </section>

  <footer class="text-center py-8 text-gray-500 text-sm border-t">
    © 2025 Честные Числа. Все вычисления выполняются локально в вашем браузере.
  </footer>

  <script>
    const entropyBits = document.getElementById('entropyBits');
    const poolBytes = document.getElementById('poolBytes');
    const poolHash = document.getElementById('poolHash');
    const testResults = document.getElementById('testResults');
    const commitHash = document.getElementById('commitHash');
    const btnReveal = document.getElementById('btnReveal');

    let pool = new Uint8Array(0);
    let committed = null;

    // Простейший симулятор генерации энтропии
    document.getElementById('startBtn').onclick = () => {
      let len = 256 + Math.floor(Math.random() * 512);
      pool = crypto.getRandomValues(new Uint8Array(len));
      poolBytes.textContent = len;
      entropyBits.textContent = `${len * 8} б.`;
      crypto.subtle.digest('SHA-256', pool).then(buf => {
        poolHash.textContent = Array.from(new Uint8Array(buf))
          .map(x => x.toString(16).padStart(2, '0')).join('');
      });
    };

    // Commit / Reveal механика
    document.getElementById('btnCommit').onclick = async () => {
      if (pool.length === 0) return;
      const hash = await crypto.subtle.digest('SHA-256', pool);
      committed = Array.from(new Uint8Array(hash)).map(x => x.toString(16).padStart(2, '0')).join('');
      commitHash.textContent = committed;
      btnReveal.disabled = false;
    };

    btnReveal.onclick = () => {
      if (!committed) return;
      testResults.textContent = `Пул (${pool.length} байт):\\n${Array.from(pool).slice(0, 64).join(', ')} ...`;
    };

    // Простые тесты
    const uniformityTest = arr => {
      let freq = new Array(256).fill(0);
      arr.forEach(x => freq[x]++);
      let mean = arr.length / 256;
      let chi2 = freq.reduce((a, f) => a + (f - mean) ** 2 / mean, 0);
      return chi2.toFixed(2);
    };

    document.getElementById('btnUniformity').onclick = () => {
      if (!pool.length) return alert('Сначала запусти генерацию');
      const res = uniformityTest(pool);
      testResults.textContent = `χ²-тест равномерности = ${res}`;
    };

    document.getElementById('btnIndependence').onclick = () => {
      if (!pool.length) return alert('Сначала запусти генерацию');
      let corr = 0;
      for (let i = 1; i < pool.length; i++) corr += pool[i] === pool[i - 1] ? 1 : 0;
      testResults.textContent = `Совпадений соседних байтов: ${corr} из ${pool.length}`;
    };

    document.getElementById('btnCorrelation').onclick = () => {
      if (!pool.length) return alert('Сначала запусти генерацию');
      let avg = pool.reduce((a, b) => a + b) / pool.length;
      let cov = 0;
      for (let i = 1; i < pool.length; i++) cov += (pool[i - 1] - avg) * (pool[i] - avg);
      testResults.textContent = `Оценка корреляции: ${cov.toFixed(2)}`;
    };
  </script>
</body>
</html>
